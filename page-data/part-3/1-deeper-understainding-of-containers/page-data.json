{"componentChunkName":"component---src-templates-course-content-template-js","path":"/part-3/1-deeper-understainding-of-containers","result":{"data":{"page":{"htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We've focused on using Docker as a tool to solve various types of problems. Meanwhile we have decided to push some of the issues until later and completely ignored others."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The goal for this part is to look into the best practices and improve our processes."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In part 1 we talked about how alpine can be a lot smaller than Ubuntu but didn't really care about why we'd choose one above the other.\nOn top of that, we have been running the applications as root, which is potentially dangerous. In addition, we're still restricting ourselves to one physical computer. Unfortunately, the last problem is out of the scope of this course. But we will get to learn about different solutions."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"look-into-the-ubuntu-image","style":"position:relative;"},"children":[{"type":"text","value":"Look into the ubuntu image"},{"type":"element","tagName":"a","properties":{"href":"#look-into-the-ubuntu-image","ariaLabel":"look into the ubuntu image permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's look into the ubuntu image on "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/r/library/ubuntu/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Docker Hub"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The description/readme says:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"What's in this image?\n\n This image is built from official rootfs tarballs provided by Canonical (specifically, https://partner-images.canonical.com/core/)."}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"From the links in the Docker Hub page we can guess (not truly know) that the image is built from "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/tianon/docker-brew-ubuntu-core","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://github.com/tianon/docker-brew-ubuntu-core"}]},{"type":"text","value":" - So from a repository owned by a person named \"Tianon Gravi\"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In that git repository's "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/tianon/docker-brew-ubuntu-core/tree/master#scripts-to-prepare-updates-to-the-ubuntu-official-docker-images","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"README"}]},{"type":"text","value":" as step 7 it says:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Some more Jenkins happens"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This step implies that somewhere there is a Jenkins server that runs this script, builds the image, and publishes the image to the registry - we have no way of knowing if this is true or not."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's see the Dockerfile of "},{"type":"element","tagName":"a","properties":{"href":"https://hub.docker.com/r/_/ubuntu/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://hub.docker.com/r/_/ubuntu/"}]},{"type":"text","value":" by clicking the 18.04 "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/tianon/docker-brew-ubuntu-core/blob/490e0e86ec5c93524b7ae37b79025e5ded5efcc6/bionic/Dockerfile","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Dockerfile link"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The first line states that the image starts FROM a "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"special"}]},{"type":"text","value":" image \"scratch\" that is just empty. Then a file "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"ubuntu-bionic-core-cloudimg-amd64-root.tar.gz"}]},{"type":"text","value":" is added to the root from the same "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/tianon/docker-brew-ubuntu-core/tree/490e0e86ec5c93524b7ae37b79025e5ded5efcc6/bionic","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"directory"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This file should be the \"..official rootfs tarballs provided by Canonical\" mentioned earlier, but it's not actually coming from "},{"type":"element","tagName":"a","properties":{"href":"https://partner-images.canonical.com/core/bionic/current/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"canonical"}]},{"type":"text","value":", it is copied from repo owned by \"tianon\". We could verify the checksums of the file if we were interested."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Notice how the file is not extracted at any point. The "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"ADD"}]},{"type":"text","value":" instruction "},{"type":"element","tagName":"a","properties":{"href":"https://docs.docker.com/engine/reference/builder/#add","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"documentation"}]},{"type":"text","value":" states that \"If src is a local tar archive in a recognized compression format (identity, gzip, bzip2 or xz) then it is unpacked as a directory. \""}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Before getting stressed by the potential security problems with this, we have to remind ourselves:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"\"You can't trust code that you did not totally create yourself.\" - Ken Thompson (1984, Reflections on Trusting Trust)."}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"However, we will assume that the "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"ubuntu:18.04"}]},{"type":"text","value":" that we downloaded is this image. The command "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"image history"}]},{"type":"text","value":" supports us:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"$ docker image history --no-trunc ubuntu:18.04"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The output from image history matches with the directives specified in the Dockerfile. In case this isn't enough, we could also build the image ourselves. The build process is, as we saw, truly open, and there is nothing that makes the \"official\" image special."}]}],"data":{"quirksMode":false}},"html":"<p>We've focused on using Docker as a tool to solve various types of problems. Meanwhile we have decided to push some of the issues until later and completely ignored others.</p>\n<p>The goal for this part is to look into the best practices and improve our processes.</p>\n<p>In part 1 we talked about how alpine can be a lot smaller than Ubuntu but didn't really care about why we'd choose one above the other.\nOn top of that, we have been running the applications as root, which is potentially dangerous. In addition, we're still restricting ourselves to one physical computer. Unfortunately, the last problem is out of the scope of this course. But we will get to learn about different solutions.</p>\n<h2 id=\"look-into-the-ubuntu-image\" style=\"position:relative;\">Look into the ubuntu image<a href=\"#look-into-the-ubuntu-image\" aria-label=\"look into the ubuntu image permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Let's look into the ubuntu image on <a href=\"https://hub.docker.com/r/library/ubuntu/\" target=\"_blank\" rel=\"noopener noreferrer\">Docker Hub</a></p>\n<p>The description/readme says:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">What&#39;s in this image?\n\n This image is built from official rootfs tarballs provided by Canonical (specifically, https://partner-images.canonical.com/core/).</code></pre></div>\n<p>From the links in the Docker Hub page we can guess (not truly know) that the image is built from <a href=\"https://github.com/tianon/docker-brew-ubuntu-core\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/tianon/docker-brew-ubuntu-core</a> - So from a repository owned by a person named \"Tianon Gravi\".</p>\n<p>In that git repository's <a href=\"https://github.com/tianon/docker-brew-ubuntu-core/tree/master#scripts-to-prepare-updates-to-the-ubuntu-official-docker-images\" target=\"_blank\" rel=\"noopener noreferrer\">README</a> as step 7 it says:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Some more Jenkins happens</code></pre></div>\n<p>This step implies that somewhere there is a Jenkins server that runs this script, builds the image, and publishes the image to the registry - we have no way of knowing if this is true or not.</p>\n<p>Let's see the Dockerfile of <a href=\"https://hub.docker.com/r/_/ubuntu/\" target=\"_blank\" rel=\"noopener noreferrer\">https://hub.docker.com/r/_/ubuntu/</a> by clicking the 18.04 <a href=\"https://github.com/tianon/docker-brew-ubuntu-core/blob/490e0e86ec5c93524b7ae37b79025e5ded5efcc6/bionic/Dockerfile\" target=\"_blank\" rel=\"noopener noreferrer\">Dockerfile link</a>.</p>\n<p>The first line states that the image starts FROM a <strong>special</strong> image \"scratch\" that is just empty. Then a file <code class=\"language-text\">ubuntu-bionic-core-cloudimg-amd64-root.tar.gz</code> is added to the root from the same <a href=\"https://github.com/tianon/docker-brew-ubuntu-core/tree/490e0e86ec5c93524b7ae37b79025e5ded5efcc6/bionic\" target=\"_blank\" rel=\"noopener noreferrer\">directory</a>.</p>\n<p>This file should be the \"..official rootfs tarballs provided by Canonical\" mentioned earlier, but it's not actually coming from <a href=\"https://partner-images.canonical.com/core/bionic/current/\" target=\"_blank\" rel=\"noopener noreferrer\">canonical</a>, it is copied from repo owned by \"tianon\". We could verify the checksums of the file if we were interested.</p>\n<p>Notice how the file is not extracted at any point. The <code class=\"language-text\">ADD</code> instruction <a href=\"https://docs.docker.com/engine/reference/builder/#add\" target=\"_blank\" rel=\"noopener noreferrer\">documentation</a> states that \"If src is a local tar archive in a recognized compression format (identity, gzip, bzip2 or xz) then it is unpacked as a directory. \"</p>\n<p>Before getting stressed by the potential security problems with this, we have to remind ourselves:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&quot;You can&#39;t trust code that you did not totally create yourself.&quot; - Ken Thompson (1984, Reflections on Trusting Trust).</code></pre></div>\n<p>However, we will assume that the <code class=\"language-text\">ubuntu:18.04</code> that we downloaded is this image. The command <code class=\"language-text\">image history</code> supports us:</p>\n<div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ docker image history --no-trunc ubuntu:18.04</code></pre></div>\n<p>The output from image history matches with the directives specified in the Dockerfile. In case this isn't enough, we could also build the image ourselves. The build process is, as we saw, truly open, and there is nothing that makes the \"official\" image special.</p>","frontmatter":{"path":"/part-3/1-deeper-understainding-of-containers","title":"Deeper understanding of containers"},"fileAbsolutePath":"/home/runner/work/docker-hy.github.io/docker-hy.github.io/data/part-3/section-1.md"},"allPages":{"edges":[{"node":{"id":"4352ae37-1cc5-5973-956b-aa3c8cc1a438","frontmatter":{"path":"/faq","title":"Frequently asked questions"}}},{"node":{"id":"e1238e90-e69f-5b89-ae7f-7a3890359b73","frontmatter":{"path":"/frontmatter-guide","title":"Frontmatter-guide"}}},{"node":{"id":"3cb91679-41d9-585e-8746-8d7f0fbc121a","frontmatter":{"path":"/getting-started","title":"Getting started"}}},{"node":{"id":"cc180895-565d-5264-95c9-d15f066c38c3","frontmatter":{"path":"/","title":"About this course"}}},{"node":{"id":"0601dd7a-78da-53bb-9402-15fadc681ddc","frontmatter":{"path":"/links","title":"Links"}}},{"node":{"id":"6c9405c1-39a6-56b2-934e-33850f881070","frontmatter":{"path":"/part-1","title":"Part 1"}}},{"node":{"id":"c5438964-0c78-52f9-b28f-f73711d88666","frontmatter":{"path":"/part-1/1-getting-started","title":"Definitions and basic concepts"}}},{"node":{"id":"a8076827-affa-555a-b777-dba87c8e257f","frontmatter":{"path":"/part-1/2-running-and-stopping","title":"Running and stopping containers"}}},{"node":{"id":"d1d17462-978a-5516-8207-0fff56d3d301","frontmatter":{"path":"/part-1/3-in-depth-dive-to-images","title":"In-depth dive to images"}}},{"node":{"id":"b86409c3-2663-57ce-9a34-5ba818f8c6f7","frontmatter":{"path":"/part-1/4-defining-start-conditions","title":"Defining start conditions for the container"}}},{"node":{"id":"f0602d39-4b70-5d33-81a1-44c74bc6a963","frontmatter":{"path":"/part-1/5-volumes-and-ports","title":"Interacting with the container via volumes and ports"}}},{"node":{"id":"eb754b3f-0629-5970-a322-6a4dc4564d67","frontmatter":{"path":"/part-1/6-docker-hub","title":"Utilizing tools from the Registry"}}},{"node":{"id":"d1c71e59-47d3-54fd-a486-383c8377fe36","frontmatter":{"path":"/part-1/7-summary","title":"Summary"}}},{"node":{"id":"0c108910-d460-5d9b-8099-772363806cd1","frontmatter":{"path":"/part-2","title":"Part 2"}}},{"node":{"id":"5ecd7aff-3a9d-5952-a0e4-50e15971e6be","frontmatter":{"path":"/part-2/1-migrating-to-docker-compose","title":"Migrating to docker compose"}}},{"node":{"id":"4007819b-0805-5da6-bf6a-99ded7c679ba","frontmatter":{"path":"/part-2/2-docker-networking","title":"Docker networking"}}},{"node":{"id":"663340ff-6dff-50cc-9bb2-25940e07ee07","frontmatter":{"path":"/part-2/3-volumes-in-action","title":"Volumes in action"}}},{"node":{"id":"fccc6c0d-db88-5605-9dcf-032a5afa0c28","frontmatter":{"path":"/part-2/4-containers-in-development","title":"Containers in development"}}},{"node":{"id":"d765d5bb-ef50-576a-8818-9938b2930e71","frontmatter":{"path":"/part-2/5-summary","title":"Summary"}}},{"node":{"id":"562b2219-bfee-5004-b19d-67666caa20c1","frontmatter":{"path":"/part-3","title":"Part 3"}}},{"node":{"id":"a43415c2-1067-541e-83ce-30fbd4938a64","frontmatter":{"path":"/part-3/1-deeper-understainding-of-containers","title":"Deeper understanding of containers"}}},{"node":{"id":"f13c2ceb-97e3-50e6-9153-9fd8c7b4eb5a","frontmatter":{"path":"/part-3/2-deployment-pipelines","title":"Deployment pipelines"}}},{"node":{"id":"baa5a147-830d-5a73-b883-2eef8b123a54","frontmatter":{"path":"/part-3/3-using-non-root-user","title":"Using a non-root user"}}},{"node":{"id":"b172f390-4ffa-568d-99e8-737985f35a70","frontmatter":{"path":"/part-3/4-optimizing-the-image-size","title":"Optimizing the image size"}}},{"node":{"id":"76657527-40ce-5179-88b3-0df3d0ae2ab9","frontmatter":{"path":"/part-3/5-multi-host-environments","title":"Multi-host environments"}}},{"node":{"id":"3405a024-ea45-5fd0-8004-ec8726591ee1","frontmatter":{"path":"/part-3/6-end","title":"End"}}}]}},"pageContext":{}},"staticQueryHashes":["3294351120","994120085"]}