"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[258],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>f});var a=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,a,o=function(e,t){if(null==e)return{};var r,a,o={},n=Object.keys(e);for(a=0;a<n.length;a++)r=n[a],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(a=0;a<n.length;a++)r=n[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var c=a.createContext({}),l=function(e){var t=a.useContext(c),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},u=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},p="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var r=e.components,o=e.mdxType,n=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=l(r),d=o,f=p["".concat(c,".").concat(d)]||p[d]||h[d]||n;return r?a.createElement(f,i(i({ref:t},u),{},{components:r})):a.createElement(f,i({ref:t},u))}));function f(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var n=r.length,i=new Array(n);i[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[p]="string"==typeof e?e:o,i[1]=s;for(var l=2;l<n;l++)i[l]=r[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,r)}d.displayName="MDXCreateElement"},3469:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>n,metadata:()=>s,toc:()=>l});var a=r(7462),o=(r(7294),r(3905));const n={title:"Official Images and trust"},i=void 0,s={unversionedId:"part-3/section-1",id:"part-3/section-1",title:"Official Images and trust",description:"We've focused on using Docker as a tool to solve various types of problems. Meanwhile we have decided to push some of the issues until later and completely ignored others.",source:"@site/docs/part-3/section-1.md",sourceDirName:"part-3",slug:"/part-3/section-1",permalink:"/part-3/section-1",draft:!1,editUrl:"https://github.com/docker-hy/docker-hy.github.io/blob/master/docs/part-3/section-1.md",tags:[],version:"current",frontMatter:{title:"Official Images and trust"},sidebar:"materialSidebar",previous:{title:"Introduction to Part 3",permalink:"/part-3/"},next:{title:"Deployment pipelines",permalink:"/part-3/section-2"}},c={},l=[{value:"Look into official images",id:"look-into-official-images",level:2},{value:"&quot;You can&#39;t trust code that you did not totally create yourself.&quot;",id:"you-cant-trust-code-that-you-did-not-totally-create-yourself",level:4},{value:"- Ken Thompson (1984, Reflections on Trusting Trust)",id:"--ken-thompson-1984-reflections-on-trusting-trust",level:6}],u={toc:l},p="wrapper";function h(e){let{components:t,...r}=e;return(0,o.kt)(p,(0,a.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"We've focused on using Docker as a tool to solve various types of problems. Meanwhile we have decided to push some of the issues until later and completely ignored others."),(0,o.kt)("p",null,"The goal for this part is to look into some of the best container practices and improve our processes."),(0,o.kt)("p",null,"In ",(0,o.kt)("a",{parentName:"p",href:"/part-1/section-3#exercises-15---16"},"part 1")," we talked about how ",(0,o.kt)("a",{parentName:"p",href:"https://www.alpinelinux.org/"},"Alpine Linux")," image can be quite a bit than Ubuntu but didn't really care about why we'd choose one above the other. On top of that, we have been running the applications as ",(0,o.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Superuser"},"root"),", i.e. the super user, which is potentially dangerous."),(0,o.kt)("h2",{id:"look-into-official-images"},"Look into official images"),(0,o.kt)("p",null,'Which version is considered to be the "official" version is up to the maintainers of ',(0,o.kt)("a",{parentName:"p",href:"https://github.com/docker-library/official-images"},"Docker Official Images")," to decide. The official images ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/docker-library/official-images"},"repository")," contains a library of images considered official. They are introduced into the library by regular pull request processes. The extended process for verifying an image is described in the repository README."),(0,o.kt)("p",null,"Many of the most well known projects are maintained under the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/docker-library"},"docker-library")," organization. Those include images such as Postgres and Python. But many of them are added to the library, but are maintained in a separate organization, such as Ubuntu and ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/nodejs/docker-node"},"Nodejs"),"."),(0,o.kt)("p",null,"Let's look into the Ubuntu image on ",(0,o.kt)("a",{parentName:"p",href:"https://hub.docker.com/r/library/ubuntu/"},"Docker Hub")," and trace the process."),(0,o.kt)("p",null,"The description/readme says:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"What's in this image?\n\n This image is built from official rootfs tarballs provided by Canonical\n (see dist-* tags at https://git.launchpad.net/cloud-images/+oci/ubuntu-base).\n")),(0,o.kt)("p",null,"We can see that the image is built from ",(0,o.kt)("a",{parentName:"p",href:"https://git.launchpad.net/cloud-images/+oci/ubuntu-base"},"https://git.launchpad.net/cloud-images/+oci/ubuntu-base"),"."),(0,o.kt)("p",null,"Let's take a closer look at Ubuntu to verify where it comes from. If you click the Dockerfile link of ",(0,o.kt)("a",{parentName:"p",href:"https://hub.docker.com/r/_/ubuntu/"},"https://hub.docker.com/r/_/ubuntu/")," you'll be given a json file instead of the Dockerfile contents. The digest seems to contain the valid digest for a single architecture version listed on Docker Hub (amd64). But after downloading it and checking the digest ",(0,o.kt)("inlineCode",{parentName:"p"},"docker pull ubuntu:22.04 && docker image ls --digests")," the result does not match up."),(0,o.kt)("p",null,"We find a Dockerfile from the repository ",(0,o.kt)("a",{parentName:"p",href:"https://git.launchpad.net/cloud-images/+oci/ubuntu-base/tree/Dockerfile?h=jammy-22.04"},"here"),". We can increase trust that it's the same as the image we downloaded with ",(0,o.kt)("inlineCode",{parentName:"p"},"image history"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-console"},"$ docker image history --no-trunc ubuntu:22.04\n")),(0,o.kt)("p",null,"The output from image history matches with the directives specified in the Dockerfile. If this isn't enough, we could also build the image ourselves."),(0,o.kt)("p",null,"The first line states that the image starts FROM a ",(0,o.kt)("strong",{parentName:"p"},"special"),' image "scratch" that is just empty. Then a file ',(0,o.kt)("inlineCode",{parentName:"p"},"ubuntu-*-oci-$LAUNCHPAD_BUILD_ARCH-root.tar.gz")," is added to the root from the same ",(0,o.kt)("a",{parentName:"p",href:"https://git.launchpad.net/cloud-images/+oci/ubuntu-base/tree/?h=jammy-22.04"},"directory"),"."),(0,o.kt)("p",null,"Notice how the file is not extracted at any point. The ",(0,o.kt)("inlineCode",{parentName:"p"},"ADD")," instruction ",(0,o.kt)("a",{parentName:"p",href:"https://docs.docker.com/engine/reference/builder/#add"},"documentation"),' states that "If src is a local tar archive in a recognized compression format (identity, gzip, bzip2 or xz) then it is unpacked as a directory."'),(0,o.kt)("p",null,"We could verify the checksums of the file if we were interested. For the Ubuntu image automation from the launchpad takes care of creating the PRs to docker-library and the maintainers of the official images repository verify the PRs."),(0,o.kt)("p",null,"You can also visit the Docker Hub page for the image tag itself, which shows the layers and warns about potential security issues. Note how many different problems it finds ",(0,o.kt)("a",{parentName:"p",href:"https://hub.docker.com/layers/library/ubuntu/22.04/images/sha256-b2175cd4cfdd5cdb1740b0e6ec6bbb4ea4892801c0ad5101a81f694152b6c559?context=explore"},"here"),"."),(0,o.kt)("p",null,'Now we have learned that the build processes are open and we can verify it if we have the need. In addition, we learned that there\'s nothing that makes the "official" images special.'),(0,o.kt)("h4",{id:"you-cant-trust-code-that-you-did-not-totally-create-yourself"},'"You can\'t trust code that you did not totally create yourself."'),(0,o.kt)("h6",{id:"--ken-thompson-1984-reflections-on-trusting-trust"},"- Ken Thompson (1984, Reflections on Trusting Trust)"))}h.isMDXComponent=!0}}]);